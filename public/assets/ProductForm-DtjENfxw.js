import{_ as q,u as I,k as T,m as _,A as B,c as l,b as o,t as i,F as w,l as E,a as u,w as f,v as p,B as g,C as M,d as S,g as O,h as A,e as R,x as L,r as m,s as x,f as $,q as G,o as n}from"./index-Dn0hYYMP.js";const J={class:"product-form-container"},z={class:"form-header"},H={class:"form-title"},K={class:"form-subtitle"},W={key:0,class:"error-summary"},Q={class:"form-section"},X={class:"form-group"},Y={key:0,class:"error-message"},Z={class:"form-group"},ee={key:0,class:"error-message"},oe={class:"form-group"},ae={class:"tags-container"},re=["id","value"],se=["for"],te={key:0,class:"no-tags-message"},le={key:0,class:"error-message"},ie={class:"form-group"},ne={key:0,class:"error-message"},ue={class:"form-group"},de={key:0,class:"error-message"},fe={class:"form-section"},ce={class:"section-title"},pe={key:0,class:"current-media"},ve={key:0,class:"current-image"},me=["src","alt"],_e={key:1,class:"current-video"},ge=["src"],be={class:"form-group"},ke={for:"image_url",class:"form-label"},ye=["required"],he={key:0,class:"error-message"},xe={class:"form-group"},Pe={for:"video_url",class:"form-label"},Ve={key:0,class:"error-message"},Ce={class:"form-section"},Fe={class:"form-group form-checkbox-group"},we={for:"is_offer",class:"form-checkbox-label"},Ee={id:"offer-dates-section"},Me={class:"form-group"},Se={key:0,class:"error-message"},Ue={class:"form-group"},De={key:0,class:"error-message"},Ne={class:"form-group",id:"offer_percentage_group"},je={key:0,class:"current-offer-info"},qe={class:"old-price"},Ie={key:1,class:"error-message"},Te={class:"form-section"},Be={class:"form-group form-checkbox-group"},Oe={class:"form-group form-checkbox-group"},Ae={class:"form-actions"},Re=["disabled"],Le={__name:"ProductForm",setup($e){const P=L(),V=$();I();const c=x(()=>!!P.params.id),C=P.params.id,a=m({sku:"",name:"",price:"",description:"",tag_ids:[],image_url:null,video_url:null,is_offer:!1,offer_percentage:"",offer_start_date:"",offer_end_date:"",active:!0,featured:!1}),b=m([]),t=m({}),v=m(!1),k=m(null),y=m(null);T(async()=>{try{const s=await _.get("/tags");b.value=s.data}catch(s){console.error("Error fetching tags:",s)}c.value&&U()});const U=async()=>{v.value=!0;try{const e=(await _.get(`/products/${C}`)).data.data;a.value.sku=e.sku,a.value.name=e.name,a.value.price=e.price,a.value.description=e.description,a.value.is_offer=!!e.is_offer,a.value.offer_percentage=e.offer_percentage,a.value.offer_start_date=e.offer_start_date,a.value.offer_end_date=e.offer_end_date,a.value.active=!!e.active,a.value.featured=!!e.featured,e.tags&&(a.value.tag_ids=e.tags.map(d=>d.id)),k.value=e.image_url,y.value=e.video_url}catch(s){console.error("Error fetching product:",s),V.push("/products")}finally{v.value=!1}},F=(s,e)=>{a.value[e]=s.target.files[0]},D=async()=>{var e;t.value={},v.value=!0;const s=new FormData;s.append("sku",a.value.sku),s.append("name",a.value.name),s.append("price",a.value.price),s.append("description",a.value.description),s.append("is_offer",a.value.is_offer?1:0),s.append("active",a.value.active?1:0),s.append("featured",a.value.featured?1:0),a.value.offer_percentage&&s.append("offer_percentage",a.value.offer_percentage),a.value.offer_start_date&&s.append("offer_start_date",a.value.offer_start_date),a.value.offer_end_date&&s.append("offer_end_date",a.value.offer_end_date),a.value.tag_ids.forEach(d=>s.append("tag_ids[]",d)),a.value.image_url instanceof File&&s.append("image_url",a.value.image_url),a.value.video_url instanceof File&&s.append("video_url",a.value.video_url);try{c.value?(s.append("_method","PUT"),await _.post(`/products/${C}`,s,{headers:{"Content-Type":"multipart/form-data"}})):await _.post("/products",s,{headers:{"Content-Type":"multipart/form-data"}}),V.push("/products")}catch(d){console.error("Submission error:",d),d.response&&d.response.data.errors?(t.value=d.response.data.errors,window.scrollTo({top:0,behavior:"smooth"}),console.log("Validation errors:",t.value)):(console.error("Error saving product:",d),alert("Error al guardar: "+JSON.stringify(((e=d.response)==null?void 0:e.data)||d.message)))}finally{v.value=!1}};B(()=>a.value.is_offer,s=>{s?(a.value.offer_start_date=new Date().toISOString().split("T")[0],a.value.offer_end_date=""):a.value.offer_percentage=""});const N=x(()=>c.value?"Editar Producto":"Crear Nuevo Producto"),j=x(()=>c.value?`Modifica la información del producto "${a.value.name}"`:"Completa la información del producto");return(s,e)=>{const d=G("RouterLink");return n(),l("div",J,[o("div",z,[o("h1",H,i(N.value),1),o("p",K,i(j.value),1)]),Object.keys(t.value).length>0?(n(),l("div",W,[e[13]||(e[13]=o("p",null,"Por favor, corrige los siguientes errores:",-1)),o("ul",null,[(n(!0),l(w,null,E(t.value,(r,h)=>(n(),l("li",{key:h},i(r[0]),1))),128))])])):u("",!0),o("form",{onSubmit:R(D,["prevent"]),class:"product-form",enctype:"multipart/form-data"},[o("div",Q,[e[21]||(e[21]=o("h2",{class:"section-title"},"Información Básica",-1)),o("div",X,[e[14]||(e[14]=o("label",{for:"sku",class:"form-label"},"SKU (Código de Producto) *",-1)),f(o("input",{type:"text",id:"sku","onUpdate:modelValue":e[0]||(e[0]=r=>a.value.sku=r),required:"",class:"form-input",placeholder:"Ej: SMART-001",maxlength:"50"},null,512),[[p,a.value.sku]]),e[15]||(e[15]=o("p",{class:"form-hint"},"Código único para identificar el producto",-1)),t.value.sku?(n(),l("span",Y,i(t.value.sku[0]),1)):u("",!0)]),o("div",Z,[e[16]||(e[16]=o("label",{for:"name",class:"form-label"},"Nombre del Producto *",-1)),f(o("input",{type:"text",id:"name","onUpdate:modelValue":e[1]||(e[1]=r=>a.value.name=r),required:"",class:"form-input",placeholder:"Ej: Smartphone Pro Max"},null,512),[[p,a.value.name]]),t.value.name?(n(),l("span",ee,i(t.value.name[0]),1)):u("",!0)]),o("div",oe,[e[17]||(e[17]=o("label",{class:"form-label"},"Categorías (Tags)",-1)),o("div",ae,[(n(!0),l(w,null,E(b.value,r=>(n(),l("div",{key:r.id,class:"tag-checkbox-group"},[f(o("input",{type:"checkbox",id:`tag_${r.id}`,value:r.id,"onUpdate:modelValue":e[2]||(e[2]=h=>a.value.tag_ids=h),class:"form-checkbox"},null,8,re),[[g,a.value.tag_ids]]),o("label",{for:`tag_${r.id}`,class:"form-checkbox-label"},i(r.name),9,se)]))),128)),b.value.length===0?(n(),l("p",te,"No hay categorías disponibles.")):u("",!0)]),e[18]||(e[18]=o("p",{class:"form-hint"},"Selecciona todas las categorías que apliquen al producto",-1)),t.value.tag_ids?(n(),l("span",le,i(t.value.tag_ids[0]),1)):u("",!0)]),o("div",ie,[e[19]||(e[19]=o("label",{for:"price",class:"form-label"},"Precio (€) *",-1)),f(o("input",{type:"number",id:"price",step:"0.01","onUpdate:modelValue":e[3]||(e[3]=r=>a.value.price=r),required:"",class:"form-input",placeholder:"Ej: 999.99",min:"0"},null,512),[[p,a.value.price]]),t.value.price?(n(),l("span",ne,i(t.value.price[0]),1)):u("",!0)]),o("div",ue,[e[20]||(e[20]=o("label",{for:"description",class:"form-label"},"Descripción *",-1)),f(o("textarea",{id:"description",rows:"4","onUpdate:modelValue":e[4]||(e[4]=r=>a.value.description=r),class:"form-input",required:"",placeholder:"Describe las características del producto..."},null,512),[[p,a.value.description]]),t.value.description?(n(),l("span",de,i(t.value.description[0]),1)):u("",!0)])]),o("div",fe,[o("h2",ce,i(c.value?"Multimedia Actual":"Multimedia"),1),c.value?(n(),l("div",pe,[k.value?(n(),l("div",ve,[o("img",{src:k.value,alt:a.value.name,class:"current-media-preview"},null,8,me),e[22]||(e[22]=o("p",{class:"current-media-label"},"Imagen actual",-1))])):u("",!0),y.value?(n(),l("div",_e,[o("video",{src:y.value,controls:"",class:"current-media-preview"},null,8,ge),e[23]||(e[23]=o("p",{class:"current-media-label"},"Video actual",-1))])):u("",!0)])):u("",!0),o("div",be,[o("label",ke,i(c.value?"Nueva Imagen (dejar vacío para mantener actual) ":"Imagen del Producto * "),1),o("input",{type:"file",id:"image_url",onChange:e[5]||(e[5]=r=>F(r,"image_url")),accept:"image/*",required:!c.value,class:"form-input-file"},null,40,ye),e[24]||(e[24]=o("p",{class:"form-hint"},"Formatos aceptados: JPG, PNG, GIF (máx. 2MB)",-1)),t.value.image_url?(n(),l("span",he,i(t.value.image_url[0]),1)):u("",!0)]),o("div",xe,[o("label",Pe,i(c.value?"Nuevo Video (dejar vacío para mantener actual) ":"Video del Producto(Opcional)"),1),o("input",{type:"file",id:"video_url",onChange:e[6]||(e[6]=r=>F(r,"video_url")),accept:"video/*",class:"form-input-file"},null,32),e[25]||(e[25]=o("p",{class:"form-hint"},"Formatos aceptados: MP4, WEBM (máx. 10MB)",-1)),t.value.video_url?(n(),l("span",Ve,i(t.value.video_url[0]),1)):u("",!0)])]),o("div",Ce,[e[34]||(e[34]=o("h2",{class:"section-title"},"Configuración de Oferta",-1)),o("div",Fe,[f(o("input",{type:"checkbox",id:"is_offer","onUpdate:modelValue":e[7]||(e[7]=r=>a.value.is_offer=r),class:"form-checkbox"},null,512),[[g,a.value.is_offer]]),o("label",we,i(c.value?"Listar en ofertas":"¿Este producto está en oferta AHORA ? "),1)]),f(o("div",Ee,[o("div",Me,[e[26]||(e[26]=o("label",{for:"offer_start_date",class:"form-label"},"Fecha de Inicio de Oferta",-1)),f(o("input",{type:"date",id:"offer_start_date","onUpdate:modelValue":e[8]||(e[8]=r=>a.value.offer_start_date=r),class:"form-input"},null,512),[[p,a.value.offer_start_date]]),e[27]||(e[27]=o("p",{class:"form-hint"},"Deja vacío si no quieres programar una oferta futura",-1)),t.value.offer_start_date?(n(),l("span",Se,i(t.value.offer_start_date[0]),1)):u("",!0)]),o("div",Ue,[e[28]||(e[28]=o("label",{for:"offer_end_date",class:"form-label"},"Fecha de Fin de Oferta",-1)),f(o("input",{type:"date",id:"offer_end_date","onUpdate:modelValue":e[9]||(e[9]=r=>a.value.offer_end_date=r),class:"form-input"},null,512),[[p,a.value.offer_end_date]]),e[29]||(e[29]=o("p",{class:"form-hint"},"Deja vacío si la oferta no tiene fecha de fin",-1)),t.value.offer_end_date?(n(),l("span",De,i(t.value.offer_end_date[0]),1)):u("",!0)])],512),[[M,!a.value.is_offer]]),f(o("div",Ne,[e[32]||(e[32]=o("label",{for:"offer_percentage",class:"form-label"},"Porcentaje de Descuento (%)",-1)),f(o("input",{type:"number",id:"offer_percentage","onUpdate:modelValue":e[10]||(e[10]=r=>a.value.offer_percentage=r),min:"1",max:"100",class:"form-input",placeholder:"Ej: 20"},null,512),[[p,a.value.offer_percentage]]),e[33]||(e[33]=o("p",{class:"form-hint"},"El precio final será calculado automáticamente",-1)),c.value&&a.value.offer_percentage&&a.value.price?(n(),l("div",je,[e[30]||(e[30]=S(" Precio actual con oferta: ",-1)),o("strong",null,i((a.value.price*(1-a.value.offer_percentage/100)).toFixed(2))+"€",1),e[31]||(e[31]=o("br",null,null,-1)),o("span",qe,"Precio original: "+i(parseFloat(a.value.price).toFixed(2))+"€",1)])):u("",!0),t.value.offer_percentage?(n(),l("span",Ie,i(t.value.offer_percentage[0]),1)):u("",!0)],512),[[M,a.value.is_offer]])]),o("div",Te,[e[37]||(e[37]=o("h2",{class:"section-title"},"Estado y Visibilidad",-1)),o("div",Be,[f(o("input",{type:"checkbox",id:"active","onUpdate:modelValue":e[11]||(e[11]=r=>a.value.active=r),class:"form-checkbox"},null,512),[[g,a.value.active]]),e[35]||(e[35]=o("label",{for:"active",class:"form-checkbox-label"},"Producto activo (visible en la tienda)",-1))]),o("div",Oe,[f(o("input",{type:"checkbox",id:"featured","onUpdate:modelValue":e[12]||(e[12]=r=>a.value.featured=r),class:"form-checkbox"},null,512),[[g,a.value.featured]]),e[36]||(e[36]=o("label",{for:"featured",class:"form-checkbox-label"},"Destacar como producto principal",-1))])]),o("div",Ae,[O(d,{to:"/products",class:"btn btn-secondary"},{default:A(()=>[...e[38]||(e[38]=[S("Cancelar",-1)])]),_:1}),o("button",{type:"submit",class:"btn btn-primary",disabled:v.value},i(v.value?"Guardando...":c.value?"Actualizar Producto":"Crear Producto"),9,Re)])],32)])}}},Je=q(Le,[["__scopeId","data-v-0dedc67b"]]);export{Je as default};
